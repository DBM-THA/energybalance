{% extends "base.html" %}
{% load static %}
{% block content %}

<style>
  body { background: #f5f7fb; }

  .summer-wrapper {
    max-width: 1100px;
    margin: 1.5rem auto 3rem auto;
    font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
  }

  .summer-header {
    text-align: center;
    margin-bottom: 1.2rem;
  }

  .summer-layout {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  .summer-column {
    flex: 1;
  }

  .summer-card {
    border-radius: 10px;
    padding: 1rem 1.3rem;
    margin-bottom: 1rem;
    background: #ffffff;
    box-shadow: 0 0 0 1px #e0e4ee;
  }

  .summer-field {
    margin-bottom: .7rem;
  }

  .summer-field label {
    display: block;
    font-size: .8rem;
    margin-bottom: .2rem;
    color: #555;
  }

  .summer-field input,
  .summer-field select {
    width: 100%;
    box-sizing: border-box;
    padding: .4rem .5rem;
    font-size: .9rem;
    border-radius: 6px;
    border: 1px solid #d0d5e0;
    background: #fbfcff;
  }

  .auto-hint {
    font-size: .8rem;
    color: #666;
    margin-top: .4rem;
  }

  @media (max-width: 900px) {
    .summer-layout {
      flex-direction: column;
    }
  }
</style>

<div class="summer-wrapper">

  <!-- HEADER -->
  <div class="summer-header">
    <h1 style="margin:0; font-size:1.6rem;">
      Sommerlicher W√§rmeschutz ‚Äì Schritt 2
    </h1>
    <p style="margin:.3rem 0 0 0; color:#666;">
      Automatische Pr√ºfung beim √Ñndern der Eingaben
    </p>
    <p style="margin:.4rem 0 0 0;">
      <a href="{% url 'summer_step1' %}">‚Üê zur√ºck zu Schritt 1</a>
    </p>
  </div>

  {% if form %}
  <form method="post" id="summer-form">
    {% csrf_token %}

    <div class="summer-layout">

      <!-- ================= LEFT COLUMN ================= -->
      <div class="summer-column">

        <div class="summer-card">
          <h2>Eingaben</h2>

          {% for field in form %}
            <div class="summer-field">
              {{ field.label_tag }}
              {{ field }}
            </div>
          {% endfor %}

          <p class="auto-hint">
            √Ñnderungen werden automatisch berechnet.
          </p>
        </div>

      </div>

      <!-- ================= RIGHT COLUMN ================= -->
      <div class="summer-column">

        <!-- Klimazone -->
        <div class="summer-card">
          <h2>Klimazone (Referenz)</h2>

          <img src="{% static 'energyapp/img/klimazone.png' %}"
               alt="Klimazonen"
               style="width:100%; border-radius:8px; border:1px solid #d0d5e0;">

          <hr style="margin:1rem 0;">

          <h3 style="font-size:.95rem;">Fc-Werte (Sonnenschutz)</h3>

          <img src="{% static 'energyapp/img/fc-werte.png' %}"
               alt="Fc-Werte"
               style="width:100%; border-radius:8px; border:1px solid #d0d5e0;">
        </div>

        <!-- Ergebnis -->
        <div class="summer-card">
          <h2>Ergebnis</h2>

          {% if result %}
            <p>S<sub>vorh</sub>: <b>{{ result.S_vorh }}</b></p>
            <p>S<sub>zul</sub>: <b>{{ result.S_zul }}</b></p>
            <p>Fc: <b>{{ result.Fc }}</b> | g: <b>{{ result.g_value }}</b></p>

            {% if result.ok %}
              <p style="color:#2f7d2f;"><b>‚úî Anforderungen erf√ºllt</b></p>
            {% else %}
              <p style="color:#b13131;"><b>‚úñ Anforderungen nicht erf√ºllt</b></p>
            {% endif %}
          {% else %}
            <p style="color:#666;">Noch keine Berechnung.</p>
          {% endif %}
        </div>

      </div>
    </div>
  </form>
  {% endif %}
</div>

<!-- üîÅ AUTO-BERECHNUNG BEIM √ÑNDERN -->
<script>
  const form = document.getElementById("summer-form");
  const inputs = form.querySelectorAll("input, select");

  let timeout = null;

  inputs.forEach(el => {
    el.addEventListener("change", () => {
      clearTimeout(timeout);
      timeout = setTimeout(() => {
        form.submit();
      }, 300);
    });
  });
</script>

{% endblock %}
