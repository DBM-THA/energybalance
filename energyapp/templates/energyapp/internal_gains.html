{% extends "base.html" %}

{% block content %}
<div class="container mt-4">

  <h1>Interne Wärmequellen</h1>
  <p class="text-muted">
    <strong>10 INNERE WÄRMEQUELLEN</strong>.
    (Derya Sütcü und Lucy Beck)

  </p>

  <form method="post" class="card p-4">
    {% csrf_token %}

    <!-- ===================== -->
    <!-- Allgemein -->
    <!-- ===================== -->
    <h4>Allgemein</h4>
    <div class="row mb-3">
      <div class="col-md-4">
        {{ form.area_m2.label_tag }}
        {{ form.area_m2 }}
      </div>
    </div>

    <hr>

    <!-- ===================== -->
    <!-- Schritt 1 – Personen -->
    <!-- ===================== -->
    <h4>Schritt 1 – Personen</h4>
    <div class="row mb-3">
      <div class="col-md-3">
        {{ form.persons_count.label_tag }}
        {{ form.persons_count }}
      </div>
      <div class="col-md-3">
        {{ form.persons_spec_w.label_tag }}
        {{ form.persons_spec_w }}
      </div>
      <div class="col-md-3">
        {{ form.persons_h_per_day.label_tag }}
        {{ form.persons_h_per_day }}
      </div>
      <div class="col-md-3">
        {{ form.persons_days_per_year.label_tag }}
        {{ form.persons_days_per_year }}
      </div>
    </div>

    <hr>

    <!-- ===================== -->
    <!-- Schritt 2 – Geräte -->
    <!-- ===================== -->
    <h4>Schritt 2 – Geräte</h4>
    <div class="row mb-3">
      <div class="col-md-3">
        {{ form.devices_count.label_tag }}
        {{ form.devices_count }}
      </div>
      <div class="col-md-3">
        {{ form.devices_spec_w.label_tag }}
        {{ form.devices_spec_w }}
      </div>
      <div class="col-md-3">
        {{ form.devices_h_per_day.label_tag }}
        {{ form.devices_h_per_day }}
      </div>
      <div class="col-md-3">
        {{ form.devices_days_per_year.label_tag }}
        {{ form.devices_days_per_year }}
      </div>
    </div>

    <hr>

    <!-- ===================== -->
    <!-- Schritt 3 – Sonstige -->
    <!-- ===================== -->
    <h4>Schritt 3 – Sonstige Wärmequellen</h4>
    <div class="row mb-3">
      <div class="col-md-3">
        {{ form.other_count.label_tag }}
        {{ form.other_count }}
      </div>
      <div class="col-md-3">
        {{ form.other_spec_w.label_tag }}
        {{ form.other_spec_w }}
      </div>
      <div class="col-md-3">
        {{ form.other_h_per_day.label_tag }}
        {{ form.other_h_per_day }}
      </div>
      <div class="col-md-3">
        {{ form.other_days_per_year.label_tag }}
        {{ form.other_days_per_year }}
      </div>
    </div>

    <hr>

    <button type="submit" class="btn btn-primary w-100">
      Berechnen
    </button>
  </form>
{% if rows %}
<div class="card p-4 mt-4">
  <h3>Ergebnisse</h3>
  <p class="text-muted mb-3">
    Die folgenden Werte werden automatisch aus den Eingaben berechnet.
  </p>

  <div class="table-responsive">
    <table class="table table-sm table-bordered align-middle">
      <thead class="table-light">
        <tr>
          <th>Quelle</th>
          <th class="text-end">Menge</th>
          <th class="text-end">spez. Leistung</th>
          <th class="text-end">Leistung</th>
          <th class="text-end">spez. Leistung</th>
          <th class="text-end">Stunden pro Tag</th>
          <th class="text-end">Tage im Jahr</th>
          <th class="text-end">Zeit im Jahr</th>
          <th class="text-end">Wärme Energie</th>
          <th class="text-end">Wärme spez. Energie</th>
          <th class="text-end">HP Anteil Heizperiode</th>
          <th class="text-end">Wärmequellen (51%)</th>
          <th class="text-end">Wärmequellen (51%) spez.</th>
        </tr>
      </thead>

      <tbody>
        {% for r in rows %}
        <tr>
          <td>{{ r.name }}</td>

          <td class="text-end">{{ r.qty|floatformat:0 }}</td>

          <td class="text-end">
            {{ r.spec_w|floatformat:2 }} W
          </td>

          <td class="text-end">
            {{ r.power_w|floatformat:2 }} W
          </td>

          <td class="text-end">
            {% if r.power_w_m2 is not None %}
              {{ r.power_w_m2|floatformat:2 }} W/m²
            {% else %}
              –
            {% endif %}
          </td>

          <td class="text-end">{{ r.h_per_day|floatformat:2 }}</td>
          <td class="text-end">{{ r.days_per_year|floatformat:0 }}</td>
          <td class="text-end">{{ r.hours_per_year|floatformat:0 }} h/a</td>

          <td class="text-end">{{ r.energy_kwh_a|floatformat:2 }} kWh/a</td>
          <td class="text-end">
            {% if r.energy_kwh_m2a is not None %}
              {{ r.energy_kwh_m2a|floatformat:2 }} kWh/m²a
            {% else %}
              –
            {% endif %}
          </td>

          <td class="text-end">{{ r.hp_share|floatformat:0 }}%</td>
          <td class="text-end">{{ r.hp_energy_kwh_a|floatformat:2 }} kWh/a</td>
          <td class="text-end">
            {% if r.hp_energy_kwh_m2a is not None %}
              {{ r.hp_energy_kwh_m2a|floatformat:2 }} kWh/m²a
            {% else %}
              –
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>

      <tfoot class="table-light fw-bold">
        <tr>
          <td>Summe</td>
          <td></td>
          <td></td>
          <td class="text-end">{{ summary.total_power_w|floatformat:2 }} W</td>
          <td class="text-end">
            {% if summary.total_power_w_m2 is not None %}
              {{ summary.total_power_w_m2|floatformat:2 }} W/m²
            {% else %}
              –
            {% endif %}
          </td>
          <td></td>
          <td></td>
          <td></td>
          <td class="text-end">{{ summary.total_energy_kwh_a|floatformat:2 }} kWh/a</td>
          <td class="text-end">
            {% if summary.total_energy_kwh_m2a is not None %}
              {{ summary.total_energy_kwh_m2a|floatformat:2 }} kWh/m²a
            {% else %}
              –
            {% endif %}
          </td>
          <td class="text-end">{{ summary.hp_share|floatformat:0 }}%</td>
          <td class="text-end">{{ summary.hp_energy_kwh_a|floatformat:2 }} kWh/a</td>
          <td class="text-end">
            {% if summary.hp_energy_kwh_m2a is not None %}
              {{ summary.hp_energy_kwh_m2a|floatformat:2 }} kWh/m²a
            {% else %}
              –
            {% endif %}
          </td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>
{% endif %}

</div>
{% endblock %}
