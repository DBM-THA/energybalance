{% extends "base.html" %}

{% block content %}

<style>
  body {
    background: #f5f7fb;
  }

  .summer-wrapper {
    max-width: 1100px;
    margin: 1.5rem auto 3rem auto;
    background: #f5f7fb;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  }

  .summer-header {
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .summer-header h1 {
    margin: 0;
    font-size: 1.6rem;
    font-weight: 600;
  }

  .summer-header p {
    margin: 0.3rem 0 0 0;
    font-size: 0.9rem;
    color: #666;
  }

  .summer-layout {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  .summer-column {
    flex: 1;
  }

  .summer-card {
    border-radius: 10px;
    padding: 1rem 1.3rem;
    margin-bottom: 1rem;
    background: #ffffff;
    box-shadow: 0 0 0 1px #e0e4ee;
  }

  .summer-card h2 {
    margin: 0 0 0.7rem 0;
    font-size: 1rem;
    font-weight: 600;
  }

  .summer-field {
    margin-bottom: 0.6rem;
  }

  .summer-field label {
    display: block;
    font-size: 0.8rem;
    margin-bottom: 0.15rem;
    color: #555;
  }

  .summer-field input,
  .summer-field select {
    width: 100%;
    box-sizing: border-box;
    padding: 0.35rem 0.5rem;
    font-size: 0.85rem;
    border-radius: 4px;
    border: 1px solid #d0d5e0;
    background: #fbfcff;
  }

  .readonly-input {
    background: #f5f7fb;
    border: 1px solid #d0d5e0;
  }

  .summer-hint {
    font-size: 0.8rem;
    color: #777;
    margin-top: 0.4rem;
  }

  .rating-badge {
    display: inline-block;
    padding: 0.25rem 0.7rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .rating-low {
    background: #e6f5e6;
    color: #2f7d2f;
  }

  .rating-medium {
    background: #fff7e0;
    color: #b08a1a;
  }

  .rating-high {
    background: #fde4e4;
    color: #b13131;
  }

  .rating-scale {
    font-size: 0.8rem;
    color: #555;
    margin-top: 0.6rem;
    line-height: 1.3;
  }

  .rating-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 0.4rem;
    vertical-align: middle;
  }

  .dot-low {
    background: #2f7d2f;
  }

  .dot-medium {
    background: #b08a1a;
  }

  .dot-high {
    background: #b13131;
  }

  .summer-graph-card {
    margin-top: 0.8rem;
  }

  .summer-graph {
    border-radius: 6px;
    border: 1px solid #d0d5e0;
    background: #ffffff;
    padding: 0.4rem;
  }

  .summer-graph svg {
    width: 100%;
    height: 140px;
  }

  .summer-actions {
    margin-top: 1.5rem;
    text-align: center;
  }

  .summer-actions button {
    padding: 0.55rem 1.6rem;
    border-radius: 999px;
    border: none;
    background: #2563eb;
    color: #fff;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
  }

  .summer-actions button:hover {
    background: #1d4ed8;
  }

  /* etwas kleinere Abstände auf sehr schmalen Bildschirmen */
  @media (max-width: 900px) {
    .summer-layout {
      flex-direction: column;
    }
  }
</style>

<div class="summer-wrapper">
  <div class="summer-header">
    <h1>Summer Overheating Module</h1>
    <p>Simple indicator for summer overheating based on solar gains and internal loads (W/m²)</p>
  </div>

  <form method="post">
    {% csrf_token %}

    <div class="summer-layout">
      <!-- LEFT COLUMN: INPUTS -->
      <div class="summer-column">
        <div class="summer-card">
          <h2>Geometry</h2>
          <div class="summer-field">
            {{ form.floor_area.label_tag }}
            {{ form.floor_area }}
          </div>
          <div class="summer-field">
            {{ form.window_area_north.label_tag }}
            {{ form.window_area_north }}
          </div>
          <div class="summer-field">
            {{ form.window_area_south.label_tag }}
            {{ form.window_area_south }}
          </div>
          <div class="summer-field">
            {{ form.window_area_east.label_tag }}
            {{ form.window_area_east }}
          </div>
          <div class="summer-field">
            {{ form.window_area_west.label_tag }}
            {{ form.window_area_west }}
          </div>
        </div>

        <div class="summer-card">
          <h2>Optical Properties</h2>
          <div class="summer-field">
            {{ form.g_value.label_tag }}
            {{ form.g_value }}
          </div>
          <div class="summer-field">
            {{ form.shading_factor.label_tag }}
            {{ form.shading_factor }}
          </div>
        </div>

        <div class="summer-card">
          <h2>Internal Loads</h2>
          <div class="summer-field">
            {{ form.internal_gains_density.label_tag }}
            {{ form.internal_gains_density }}
          </div>
        </div>

        <div class="summer-card">
          <h2>Climate (Info Only)</h2>
          <div class="summer-field">
            {{ form.outdoor_temp_peak.label_tag }}
            {{ form.outdoor_temp_peak }}
          </div>
          <div class="summer-field">
            {{ form.set_temp.label_tag }}
            {{ form.set_temp }}
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN: OUTPUTS -->
      <div class="summer-column">
        <div class="summer-card">
          <h2>Auto-Calculated Value</h2>
          {% if result %}
            <div class="summer-field">
              <label>Auto indicator [W/m²]</label>
              <input class="readonly-input" type="number"
                     value="{{ result.auto_indicator_W_m2|floatformat:1 }}"
                     readonly>
            </div>
            <p class="summer-hint">
              Formula (concept): q<sub>solar</sub> + q<sub>int</sub> / floor_area, with
              simplified summer solar intensity of 500&nbsp;W/m².
            </p>
          {% else %}
            <p>No result calculated yet. Enter values and click “Calculate &amp; Save”.</p>
          {% endif %}
        </div>

        <div class="summer-card">
          <h2>Override (Optional)</h2>
          <div class="summer-field">
            {{ form.override_indicator.label_tag }}
            {{ form.override_indicator }}
          </div>
          <p class="summer-hint">
            If this value is filled, it replaces the auto-calculated indicator.
            Leave empty to use the auto value.
          </p>
        </div>

        <div class="summer-card">
          <h2>Effective Result</h2>
          {% if result %}
            <div class="summer-field">
              <label>Effective indicator [W/m²]</label>
              <input class="readonly-input" type="number"
                     value="{{ result.effective_indicator_W_m2|floatformat:1 }}"
                     readonly>
            </div>

            {% with result.rating as r %}
              <p>
                {% if "low" in r %}
                  <span class="rating-badge rating-low">Low overheating risk (&lt; 10 W/m²)</span>
                {% elif "medium" in r %}
                  <span class="rating-badge rating-medium">Medium overheating risk (10–20 W/m²)</span>
                {% elif "high" in r %}
                  <span class="rating-badge rating-high">High overheating risk (&gt; 20 W/m²)</span>
                {% else %}
                  <span class="rating-badge">{{ r }}</span>
                {% endif %}
              </p>
            {% endwith %}

            <div class="rating-scale">
              <div><span class="rating-dot dot-low"></span>Low overheating risk (&lt; 10 W/m²)</div>
              <div><span class="rating-dot dot-medium"></span>Medium overheating risk (10–20 W/m²)</div>
              <div><span class="rating-dot dot-high"></span>High overheating risk (&gt; 20 W/m²)</div>
            </div>

            <div class="summer-graph-card">
              <div class="summer-graph">
                <!-- einfacher Platzhalter-Graph -->
                <svg viewBox="0 0 100 40" preserveAspectRatio="none">
                  <!-- Achsen -->
                  <line x1="5" y1="35" x2="95" y2="35" stroke="#ccc" stroke-width="0.5"/>
                  <line x1="5" y1="5" x2="5" y2="35" stroke="#ccc" stroke-width="0.5"/>

                  <!-- „Temperatur“-Kurve -->
                  <polyline
                    fill="none"
                    stroke="#555"
                    stroke-width="1.2"
                    points="5,15 20,10 35,12 50,11 65,9 80,8 95,7" />

                  <!-- „Overheating indicator“-Kurve -->
                  <polyline
                    fill="none"
                    stroke="#999"
                    stroke-width="1.2"
                    points="5,30 20,29 35,27 50,24 65,20 80,15 95,13" />
                </svg>
              </div>
            </div>
          {% else %}
            <p>No effective result yet.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="summer-actions">
      <button type="submit">Calculate &amp; Save</button>
    </div>
  </form>
</div>

{% endblock %}
