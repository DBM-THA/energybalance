{% extends "base.html" %}
{% load math_tags %}
{% load form_tags %}

{% block body_class %}summary-page{% endblock %}

{% block content %}

<!-- Header -->
<div class="page-header">
    <div>
        <h1 class="page-header-title">Ergebnis Energie</h1>
        <p class="page-header-subtitle">
            Auf dieser Seite ist eine Ergebnisübersicht für die Energie einzusehen.
            Dieses Blatt dient der Kontrolle und Anpassung, nicht der Berechnung an sich.
        </p>
    </div>
</div>

<!-- Falls kein Gebäude ausgewählt werden kann -->
{% if not building %}
<div class="alert alert-danger mt-4">
    <strong>Keine Gebäudedaten vorhanden.</strong><br>
    Bitte zuerst ein Gebäude anlegen oder berechnen.
</div>
{% endif %}

<!-- Falls keine Ergebnisse vorhanden -->
{% if not energy_results %}
<div class="alert alert-warning mt-3">
    Noch keine Berechnungen durchgeführt.
</div>
{% endif %}


<!-- --------------------------------------------- -->
<!-- STYLES -->
<!-- --------------------------------------------- -->
<style>
    .section-header {
        background-color: #e2efda; /* hellgrün */
        font-weight: bold;
    }
    .cell-grey {
        background-color: #d9d9d9; /* hellgrau */
    }
    .table-energy td, .table-energy th {
        vertical-align: middle;
        padding: 4px 8px;
    }
</style>


{% if building %}
<!-- --------------------------------------------- -->
<!-- NUTZENERGIE -->
<!-- --------------------------------------------- -->
<h2 class="mt-4">Nutzenergie</h2>

<table class="table table-bordered table-energy">

    <thead>
        <tr class="section-header">
            <th>Energiedienstleistung</th>
            <th>Arbeitsblatt</th>
            <th>Energiebedarf<br>kWh/a</th>
            <th>spezifisch<br>kWh/m²a</th>
            <th>Vergleich Messung</th>
            <th>Kommentar</th>
        </tr>
    </thead>

    <tbody>

        <!-- Heizwärme -->
        <tr>
            <td>Heizwärme</td>
            <td>Monatsbilanz</td>
            <td>{{ building.result_Q_h|default:0|floatformat:0 }}</td>
            <td>
                {{ building.result_Q_h|default:0|div:building.result_floor_area|default:0|floatformat:2 }}
            </td>
            <td class="cell-grey"></td>
            <td>Passivhaus &lt;= 15 kWh/m²a</td>
        </tr>

        <!-- Heizwärme Beleuchtung -->
        <tr>
            <td>Heizwärme Beleuchtung</td>
            <td>n. v.</td>
            <td>5</td>
            <td>6.00</td>
            <td class="cell-grey"></td>
            <td>nicht berücksichtigt</td>
        </tr>

        <!-- Trinkwarmwasser -->
        <tr>
            <td>Trinkwarmwasser</td>
            <td>Licht + Wasser</td>
            <td>1.095</td>
            <td>1.83</td>
            <td class="cell-grey"></td>
            <td>Standardwert 4108-6</td>
        </tr>

        <!-- Luftförderung -->
        <tr>
            <td>Luftförderung</td>
            <td>Luftförderung</td>
            <td>11.203</td>
            <td>18.67</td>
            <td class="cell-grey"></td>
            <td></td>
        </tr>

        <!-- Kälte -->
        <tr>
            <td>Kälte</td>
            <td>n. v.</td>
            <td>0</td>
            <td>0.00</td>
            <td class="cell-grey"></td>
            <td>keine aktive Kühlung</td>
        </tr>

        <!-- Beleuchtung -->
        <tr>
            <td>Beleuchtung</td>
            <td>Licht + Wasser</td>
            <td>2.116</td>
            <td>3.53</td>
            <td class="cell-grey"></td>
            <td></td>
        </tr>

        <!-- Sonstiges -->
        <tr>
            <td>Sonstiges</td>
            <td>n. v.</td>
            <td>0</td>
            <td>0.00</td>
            <td class="cell-grey"></td>
            <td>nicht berücksichtigt</td>
        </tr>

        <!-- Nutzer Prozess -->
        <tr>
            <td>Nutzer (Prozess)</td>
            <td>n. v.</td>
            <td>6.000</td>
            <td>10.00</td>
            <td class="cell-grey"></td>
            <td></td>
        </tr>

    </tbody>

</table>



<!-- --------------------------------------------- -->
<!-- ENDENERGIEBEDARF -->
<!-- --------------------------------------------- -->
<h3 class="mt-3">Endenergiebedarf nach Energieträger</h3>

<table class="table table-bordered table-energy">

    <thead class="section-header">
        <tr>
            <th>Energieträger</th>
            <th>Faktor</th>
            <th>kWh/a</th>
            <th>kWh/m²a</th>
            <th>Kommentar</th>
        </tr>
    </thead>

    <tbody>

        <tr>
            <td>Wärmeerzeuger WP</td>
            <td>0,29</td>
            <td>4.970</td>
            <td>8,28</td>
            <td>Anteil × 1/Arbeitszahl WP (4)</td>
        </tr>

        <tr>
            <td>Wärmeerzeuger FW</td>
            <td>0,40</td>
            <td>0</td>
            <td>0,00</td>
            <td>Anteil + Verluste</td>
        </tr>

        <tr>
            <td>Wärmeerzeuger Gas</td>
            <td>1,10</td>
            <td>0</td>
            <td>0,00</td>
            <td>Anteil + Verluste</td>
        </tr>

        <tr>
            <td>Hilfsenergie Heizung</td>
            <td>0,03</td>
            <td>522</td>
            <td>0,87</td>
            <td>3% pauschal</td>
        </tr>

        <tr>
            <td>Trinkwarmwasser</td>
            <td>1,00</td>
            <td>1.095</td>
            <td>1,83</td>
            <td>Durchlauferhitzer</td>
        </tr>

        <tr>
            <td>Luftförderung</td>
            <td>1,00</td>
            <td>11.203</td>
            <td>18,67</td>
            <td></td>
        </tr>

        <tr>
            <td>Beleuchtung</td>
            <td>1,00</td>
            <td>2.116</td>
            <td>3,53</td>
            <td></td>
        </tr>

        <tr>
            <td>Nutzer (Prozess)</td>
            <td>1,00</td>
            <td>6.000</td>
            <td>10,00</td>
            <td></td>
        </tr>

        <!-- Endenergie-Summe -->
        <tr class="table-secondary fw-bold">
            <td>Endenergiebedarf gesamt</td>
            <td></td>
            <td>25.906</td>
            <td>43,18</td>
            <td></td>
        </tr>

    </tbody>

</table>

<!-- --------------------------------------------- -->
<!-- Endenrgie Strom-->
<!-- --------------------------------------------- -->
<h3 class="mt-4">Endenergie Strom</h3>

<table class="table table-bordered table-energy">

    <thead class="section-header">
        <tr>
            <th>Energiedienstleistung</th>
            <th>Faktor</th>
            <th>kWh/a</th>
            <th>kWh/m²a</th>
            <th>Kommentar</th>
        </tr>
    </thead>

    <tbody>

        <!-- Wärmeerzeuger WP -->
        <tr>
            <td>Wärmeerzeuger WP</td>
            <td>1,00</td>
            <td>4.970</td>
            <td>8,28</td>
            <td>Anteil × Faktor = Anteil × 1/Arbeitszahl WP (4)</td>
        </tr>

        <!-- Wärmeerzeuger FW -->
        <tr>
            <td>Wärmeerzeuger FW</td>
            <td>0,00</td>
            <td>0</td>
            <td>0,00</td>
            <td></td>
        </tr>

        <!-- Wärmeerzeuger Gas -->
        <tr>
            <td>Wärmeerzeuger Gas</td>
            <td>0,00</td>
            <td>0</td>
            <td>0,00</td>
            <td>sollte immer NULL sein (kein Stromverbrauch)</td>
        </tr>

        <!-- Hilfsenergie Heizung -->
        <tr>
            <td>Hilfsenergie Heizung</td>
            <td></td>
            <td>522</td>
            <td>0,87</td>
            <td>3% pauschal</td>
        </tr>

        <!-- Trinkwarmwasser (wenn elektrisch) -->
        <tr>
            <td>Trinkwarmwasser (wenn elektrisch)</td>
            <td>1,00</td>
            <td>1.095</td>
            <td>1,83</td>
            <td>elektrisch = 1; sonst Hilfsenergie = 3% pauschal</td>
        </tr>

        <!-- Luftförderung -->
        <tr>
            <td>Luftförderung</td>
            <td></td>
            <td>11.203</td>
            <td>18,67</td>
            <td></td>
        </tr>

        <!-- Beleuchtung -->
        <tr>
            <td>Beleuchtung</td>
            <td></td>
            <td>2.116</td>
            <td>3,53</td>
            <td></td>
        </tr>

        <!-- Nutzer (Prozess) -->
        <tr>
            <td>Nutzer (Prozess)</td>
            <td></td>
            <td>6.000</td>
            <td>10,00</td>
            <td></td>
        </tr>

        <!-- SUMME -->
        <tr class="table-secondary fw-bold">
            <td>Endenergiebedarf Strom</td>
            <td></td>
            <td>25.906</td>
            <td>43,18</td>
            <td></td>
        </tr>

    </tbody>

</table>


<!-- --------------------------------------------- -->
<!-- PRIMÄRENERGIE -->
<!-- --------------------------------------------- -->
<<h3 class="mt-4">Primärenergie (nicht mit GEG vergleichbar!)</h3>

<table class="table table-bordered table-energy">

    <thead class="section-header">
        <tr>
            <th>Energiequelle</th>
            <th>Faktor</th>
            <th>Primärenergiebedarf<br>kWh/a</th>
            <th>spezifisch<br>kWh/m²a</th>
            <th>Vergleich Messung</th>
            <th>Deckungsanteil</th>
        </tr>
    </thead>

    <tbody>

        <!-- Wärme Solar -->
        <tr>
            <td>Wärme Solar</td>
            <td>0,00</td>
            <td>0</td>
            <td>0,00</td>
            <td class="cell-grey"></td>
            <td></td>
        </tr>

        <!-- Wärme Fernwärme -->
        <tr>
            <td>Wärme Fernwärme</td>
            <td>0,25</td>
            <td>0</td>
            <td>0,00</td>
            <td class="cell-grey"></td>
            <td></td>
        </tr>

        <!-- Wärme Gas -->
        <tr>
            <td>Wärme Gas</td>
            <td>1,10</td>
            <td>0</td>
            <td>0,00</td>
            <td class="cell-grey"></td>
            <td></td>
        </tr>

        <!-- Strom (On-Site) -->
        <tr style="background-color:#bfbfbf;">
            <td><strong>Strom (On-Site)*</strong></td>
            <td>-1,80</td>
            <td>-32.642</td>
            <td>-54,40</td>
            <td class="cell-grey"></td>
            <td style="color:#0066cc; font-weight:bold;">70%</td>
        </tr>

        <!-- Strom (Off-Site) -->
        <tr style="background-color:#d9d9d9;">
            <td><strong>Strom (Off-Site)</strong></td>
            <td>1,80</td>
            <td>46.631</td>
            <td>77,72</td>
            <td class="cell-grey"></td>
            <td style="color:#0066cc; font-weight:bold;">100%</td>
        </tr>

        <!-- Hinweis -->
        <tr>
            <td colspan="6" class="text-muted small">
                * Im GEG Nachweis wird eine Monatsbilanz mit jeweils anrechenbaren Anteilen erstellt.
                Hier idealisierte Bilanz über das ganze Jahr!
            </td>
        </tr>

    </tbody>
</table>


<!-- ================================================ -->
<!-- PRIMÄRENERGIE – ENDWERT (grüner Gesamtblock) -->
<!-- ================================================ -->

<table class="table table-bordered mt-1">
    <tr style="background-color:#548235; color:white; font-weight:bold; font-size:1.2rem;">
        <td style="width:50%;">Primärenergiebedarf</td>
        <td style="text-align:right;">13.989</td>
        <td style="text-align:right;">23,32</td>
    </tr>
    <tr style="background-color:#e2efda; font-weight:bold;">
        <td></td>
        <td style="text-align:right;">kWh/a</td>
        <td style="text-align:right;">kWh/m²a</td>
    </tr>
</table>



<!-- --------------------------------------------- -->
<!-- PV Überschuss -->
<!-- --------------------------------------------- -->
<h3 class="mt-4">Überschuss</h3>

<table class="table table-bordered table-energy">

    <!-- Titelzeile (hellgrün) -->
    <tr style="background-color:#e2efda; font-weight:bold;">
        <td colspan="3">Überschuss</td>
    </tr>

    <!-- Hauptzeile (dunkelgrün) -->
    <tr style="background-color:#548235; color:white; font-weight:bold; font-size:1.2rem;">
        <td style="width:50%;">Strom (On-Site)</td>
        <td style="text-align:right;">19.510</td>
        <td style="text-align:right;">32,52</td>
    </tr>

    <!-- Einheitenzeile (hellgrün) -->
    <tr style="background-color:#e2efda; font-weight:bold;">
        <td></td>
        <td style="text-align:right;">kWh/a</td>
        <td style="text-align:right;">kWh/m²a</td>
    </tr>

</table>


{% endif %}
{% endblock %}
